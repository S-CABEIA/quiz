<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Angola Quiz Challenge ðŸ‡¦ðŸ‡´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        .angola-gradient {
            background: linear-gradient(135deg, #dc2626 0%, #000000 50%, #fbbf24 100%);
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #fbbf24;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .optional-badge {
            background-color: #fbbf24;
            color: #000;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen angola-gradient flex items-center justify-center p-4">
    <div class="max-w-4xl w-full">
        
        <!-- Tela de Coleta de Dados -->
        <div id="register-screen" class="text-center">
            <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 shadow-2xl border border-white/20">
                <div class="text-6xl mb-4">ðŸ‡¦ðŸ‡´</div>
                <h1 class="text-3xl font-bold text-white mb-4">Quiz FGC Team Angola</h1>
                <p class="text-lg text-white/90 mb-6">Para comeÃ§ar, por favor, insira seus dados:</p>
                
                <form id="register-form" class="space-y-4 text-left">
                    <div>
                        <label class="block text-white/90 text-sm font-medium mb-1">Nome Completo</label>
                        <input type="text" id="user-name" required
                               class="w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                               placeholder="Ex: JoÃ£o Silva">
                    </div>
                    <div>
                        <label class="block text-white/90 text-sm font-medium mb-1 flex items-center">
                            NÃºmero do WhatsApp
                            <span class="optional-badge">Opcional</span>
                        </label>
                        <input type="tel" id="user-phone"
                               class="w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-white/70 border border-white/30 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                               placeholder="Ex: +244 922 123 456" 
                               pattern="^\+\d{1,3} \d{3} \d{3} \d{3}$"
                               title="Formato: +CÃ³digo PaÃ­s NÃºmero (Ex: +244 922 123 456)">
                        <p class="text-white/60 text-xs mt-1">Se fornecido, usaremos apenas para contato sobre o quiz.</p>
                    </div>
                    <div id="loader" class="loader"></div>
                    <button type="submit" id="submit-btn"
                            class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-4 px-8 rounded-2xl shadow-lg transform transition-all duration-200 hover:scale-105 mt-6">
                        Enviar e ComeÃ§ar Quiz ðŸš€
                    </button>
                </form>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 shadow-2xl border border-white/20">
                <!-- ... (mantido igual ao anterior) ... -->
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden text-center">
            <!-- ... (mantido igual ao anterior) ... -->
        </div>
    </div>

    <script>
        // ðŸ”§ CONFIGURE AQUI SEUS DADOS DO EMAILJS
        const EMAILJS_USER_ID = "SEU_USER_ID";
        const EMAILJS_SERVICE_ID = "SEU_SERVICE_ID";
        const EMAILJS_TEMPLATE_ID = "SEU_TEMPLATE_ID";

        // Inicializa o EmailJS
        (function() {
            emailjs.init(EMAILJS_USER_ID);
        })();

        // Carregar participantes do localStorage
        function getParticipants() {
            const saved = localStorage.getItem("quizParticipants");
            return saved ? JSON.parse(saved) : [];
        }

        // Salvar novo participante
        function addParticipant(name, phone) {
            const list = getParticipants();
            list.push({ 
                Nome: name, 
                WhatsApp: phone || "NÃ£o informado", 
                Data: new Date().toLocaleString() 
            });
            localStorage.setItem("quizParticipants", JSON.stringify(list));
        }

        // Gerar Excel e enviar por e-mail
        function sendExcelEmail(name, phone) {
            const participants = getParticipants();
            const ws = XLSX.utils.json_to_sheet(participants);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Participantes");

            const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'base64' });

            const params = {
                to_email: "siaodongoxi@gmail.com",
                from_name: "Quiz FGC Team Angola",
                message: `Novo participante: ${name} (${phone || "Sem WhatsApp"})\n\nTodos os dados estÃ£o no anexo Excel.`,
                file_name: "Participantes_Quiz_FGC_Angola.xlsx",
                file_content: wbout
            };

            emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, params)
                .then(() => {
                    console.log("Dados enviados com sucesso!");
                })
                .catch((error) => {
                    console.error("Erro ao enviar e-mail:", error);
                });
        }

        // Evento de envio
        document.getElementById("register-form").addEventListener("submit", function (e) {
            e.preventDefault();
            const name = document.getElementById("user-name").value.trim();
            const phone = document.getElementById("user-phone").value.trim();

            if (!name) {
                alert("Por favor, insira seu nome completo.");
                return;
            }

            // Validar formato do telefone apenas se fornecido
            if (phone && !/^\+\d{1,3} \d{3} \d{3} \d{3}$/.test(phone)) {
                alert("Por favor, insira o nÃºmero no formato correto: +CÃ³digo PaÃ­s NÃºmero (Ex: +244 922 123 456) ou deixe em branco.");
                return;
            }

            // Mostrar carregamento
            document.getElementById("loader").style.display = "block";
            document.getElementById("submit-btn").disabled = true;
            document.getElementById("submit-btn").textContent = "Enviando...";

            // Salvar participante
            addParticipant(name, phone);

            // Enviar e-mail com Excel (nÃ£o bloqueia o quiz se falhar)
            setTimeout(() => {
                try {
                    sendExcelEmail(name, phone);
                } catch (e) {
                    console.error("Erro no envio:", e);
                }

                // Ir para o quiz
                document.getElementById("register-screen").classList.add("hidden");
                document.getElementById("quiz-screen").classList.remove("hidden");
                loadQuestion();
            }, 1500);
        });

        // ... (restante do cÃ³digo do quiz mantido igual) ...
    </script>
</body>
</html>
